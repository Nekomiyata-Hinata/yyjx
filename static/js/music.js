$(function(){function f(a){var b=null,c=[];location.search.substr(1).split("&").forEach(function(e){c=e.split("=");c[0]===a&&(b=decodeURIComponent(c[1]))});return b}function m(a,b){window.history&&window.history.pushState&&window.history.pushState(null,a,b)}function k(a){var b=location.href.split("?")[0];return a?b+a:b}var c=null,l=f("name"),n=f("id"),p=f("url"),q=f("type"),r=document.title;(l||n)&&q&&setTimeout(function(){$("#j-input").val(l||n);$('#j-type input[value="'+q+'"]').prop("checked",!0);
l&&$('#j-nav [data-filter="name"]').trigger("click");n&&$('#j-nav [data-filter="id"]').trigger("click");$("#j-validator").trigger("submit")},0);p&&setTimeout(function(){$("#j-type").hide();$("#j-input").val(p);$('#j-nav [data-filter="url"]').trigger("click");$("#j-validator").trigger("submit")},0);$("#j-nav").on("click","li",function(){var a={name:"\u4f8b\u5982: \u5510\u4eba \u5b59\u5b50\u6db5",id:"\u4f8b\u5982: 26524448",url:"\u4f8b\u5982: http://music.163.com/#/song?id=26524448",pattern_name:"^.+$",
pattern_id:"^[\\w\\/\\|]+$",pattern_url:"^https?:\\/\\/\\S+$"},b=$(this).data("filter");$(this).addClass("am-active").siblings("li").removeClass("am-active");$("#j-input").data("filter",b).attr({placeholder:a[b],pattern:a["pattern_"+b]}).removeClass("am-field-valid am-field-error am-active").closest(".am-form-group").removeClass("am-form-success am-form-error").find(".am-alert").hide();"url"===b?$("#j-type").hide():$("#j-type").show()});$("#j-validator").validator({onValid:function(a){$(a.field).closest(".am-form-group").find(".am-alert").hide()},
onInValid:function(a){var b=$(a.field),c=b.closest(".am-form-group"),e=c.find(".am-alert");a={name:"\u5c06 \u540d\u79f0 \u548c \u4f5c\u8005 \u4e00\u8d77\u8f93\u5165\u53ef\u63d0\u9ad8\u5339\u914d\u5ea6",id:"\u8f93\u5165\u9519\u8bef\uff0c\u8bf7\u67e5\u770b\u4e0b\u9762\u7684\u5e2e\u52a9",url:"\u8f93\u5165\u9519\u8bef\uff0c\u8bf7\u67e5\u770b\u4e0b\u9762\u7684\u5e2e\u52a9"}[b.data("filter")]||this.getValidationMessage(a);e.length||(e=$('<div class="am-alert am-alert-danger am-animation-shake"></div>').hide().appendTo(c));
e.html(a).show()},submit:function(a){a.preventDefault();if(this.isFormValid()){a=$.trim($("#j-input").val());var b=$("#j-input").data("filter"),f="url"===b?"_":$('input[name="music_type"]:checked').val(),e=$('<div class="aplayer-more">\u8f7d\u5165\u66f4\u591a</div>'),l=!1;(function t(a,b,f,h){$.ajax({type:"POST",url:k(),timeout:3E4,data:{input:a,filter:b,type:f,page:h},dataType:"json",beforeSend:function(){l=!0;var c=document.title;switch(b){case "name":m(c,k("?name="+a+"&type="+f));break;case "id":m(c,
k("?id="+a+"&type="+f));break;case "url":m(c,k("?url="+encodeURIComponent(a)))}1===h?($("#j-input").attr("disabled",!0),$("#j-submit").button("loading")):e.text("\u8bf7\u7a0d\u540e...")},success:function(g){if(200===g.code&&g.data){g.data.map(function(d){d.title||(d.title="\u6682\u65e0");d.author||(d.author="\u6682\u65e0");d.pic||(d.pic="static/img/nopic.jpg");d.lrc||(d.lrc="[00:00.00] \u6682\u65e0\u6b4c\u8bcd");/\[00:(\d{2})\./.test(d.lrc)||(d.lrc="[00:00.00] \u65e0\u6548\u6b4c\u8bcd")});var k=function(d){$("#j-link").val(d.link);
$("#j-link-btn").attr("href",d.link);$("#j-src").val(d.url);$("#j-src-btn").attr("href",d.url);$("#j-lrc").val(d.lrc);$("#j-lrc-btn").attr("href","data:application/octet-stream;base64,"+btoa(unescape(encodeURIComponent(d.lrc))));if("download"in $("#j-src-btn")[0]){var a=d.title+"-"+d.author;$("#j-src-btn").attr("download",a+".mp3");$("#j-lrc-btn").attr("download",a+".lrc");$("#j-src-btn-icon, #j-lrc-btn-icon").addClass("am-icon-download").removeClass("am-icon-external-link")}$("#j-songid").val(d.songid);
$("#j-name").val(d.title);$("#j-author").val(d.author)};1===h?(c&&c.pause(),k(g.data[0]),$("#j-validator").slideUp(),$("#j-main").slideDown(),c=new APlayer({element:$("#j-player")[0],autoplay:!1,narrow:!1,showlrc:1,mutex:!1,mode:"circulation",preload:"metadata",theme:"#0e90d2",music:g.data}),$("#j-player").append(e),e.on("click",function(){l||(h++,t(a,b,f,h))})):c.addMusic(g.data);c.on("canplay",function(){c.play()});c.on("play",function(){var a=g.data[c.playIndex],b=new Image;b.src=a.pic;b.onerror=
function(){$(".aplayer-pic").css("background-image","url(static/img/nopic.jpg)")};document.title="\u6b63\u5728\u64ad\u653e: "+a.title+" - "+a.author;k(a)});c.on("ended",function(){document.title=r});10>g.data.length?e.hide():e.text("\u8f7d\u5165\u66f4\u591a")}else 1===h?$("#j-input").closest(".am-form-group").find(".am-alert").html(g.error||"(\u00b0\u30fc\u00b0\u3003) \u670d\u52a1\u5668\u597d\u50cf\u7f62\u5de5\u4e86").show():(e.text("\u6ca1\u6709\u4e86"),setTimeout(function(){e.slideUp()},1E3))},
error:function(a,b){1===h?(a="(\u00b0\u30fc\u00b0\u3003) \u51fa\u4e86\u70b9\u5c0f\u95ee\u9898\uff0c\u8bf7\u91cd\u8bd5","timeout"===b&&(a="(\u00b0\u30fc\u00b0\u3003) \u8bf7\u6c42\u8d85\u65f6\u4e86\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5"),$("#j-input").closest(".am-form-group").find(".am-alert").html(a).show()):e.text("(\u00b0\u30fc\u00b0\u3003) \u52a0\u8f7d\u5931\u8d25\u4e86\uff0c\u70b9\u51fb\u91cd\u8bd5")},complete:function(){l=!1;1===h&&($("#j-input").attr("disabled",!1),$("#j-submit").button("reset"))}})})(a,
b,f,1)}}});$("#j-main input").focus(function(){$(this).select()});$("#j-more").on("click",function(){$(this).hide();$("#j-quote").removeClass("music-overflow")});$("#j-back").on("click",function(){c&&c.pause();$("#j-validator").slideDown();$("#j-main").slideUp();$("#j-main input").val("");document.title=r})});